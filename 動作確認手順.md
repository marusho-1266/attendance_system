# 出勤管理システム 動作確認手順

## 現在の実装状況

### 完了済み機能（タスク1-8）
- ✅ プロジェクト構造とコア設定の初期化
- ✅ Google スプレッドシートの構造とマスターデータの設定
- ✅ 認証・セキュリティモジュールの実装
- ✅ ユーティリティ関数の実装
- ✅ 業務ロジックモジュールの実装
- ✅ 打刻WebAppの実装
- ✅ フォーム管理・承認ワークフローの実装
- ✅ メール管理・通知システムの実装

### 未実装機能（タスク9-15）
- ❌ 自動処理トリガーの実装
- ❌ エラーハンドリングシステムの実装
- ❌ 承認処理とステータス更新の実装
- ❌ レポート生成・エクスポート機能の実装
- ❌ テスト機能の実装
- ❌ 時間トリガーの設定と最終統合
- ❌ セキュリティ設定と権限管理の最終確認

## 動作確認手順

### 1. 事前準備

#### Google Apps Scriptプロジェクトの設定
1. Google Apps Scriptプロジェクトを開く
2. 全てのソースファイル（src/*.gs）をプロジェクトにコピー
3. appsscript.jsonの設定を確認

#### スプレッドシートの準備
1. 新しいGoogle スプレッドシートを作成
2. スプレッドシートIDをメモ
3. Config.gsの管理者メールアドレスを実際のメールアドレスに変更

### 2. 初期設定の実行

#### スプレッドシート構造の設定
```javascript
// Google Apps Scriptエディタで実行
runInitialSetup();
```

この関数は以下を実行します：
- 必要なシート（Master_Employee, Master_Holiday, Log_Raw, Daily_Summary, Monthly_Summary, Request_Responses）の作成
- ヘッダー行の設定
- サンプルデータの投入
- シート保護設定の適用

### 3. 基本機能の動作確認

#### 簡単なシステム確認
```javascript
// Google Apps Scriptエディタで実行
quickSystemCheck();
```

#### 詳細なテスト実行
```javascript
// Google Apps Scriptエディタで実行
runBasicTests();
```

#### 統合テストの実行
```javascript
// Google Apps Scriptエディタで実行
testTimeEntryIntegration();
```

### 4. WebAppの動作確認

#### WebAppのデプロイ
1. Google Apps Scriptエディタで「デプロイ」→「新しいデプロイ」
2. 種類：「ウェブアプリ」を選択
3. 実行ユーザー：「自分」
4. アクセスできるユーザー：「Googleアカウントを持つ全員」
5. デプロイを実行してURLを取得

#### 打刻機能のテスト
1. デプロイしたWebAppのURLにアクセス
2. 認証が正常に動作するか確認
3. 各打刻ボタン（出勤、退勤、休憩開始、休憩終了）の動作確認
4. Log_Rawシートにデータが記録されるか確認

### 5. 業務ロジックの動作確認

#### 労働時間計算のテスト
```javascript
// テスト用の従業員IDと日付で実行
const testResult = calculateDailyWorkTime('EMP001', new Date());
Logger.log(testResult);
```

#### 祝日判定のテスト
```javascript
// 元日（祝日）での確認
const holidayResult = isHoliday(new Date('2024-01-01'));
Logger.log(holidayResult);
```

### 6. データベース操作の確認

#### スプレッドシートデータの読み書きテスト
```javascript
// データベース操作テストの実行
testDatabaseOperations();
```

## 確認すべきポイント

### 正常動作の確認項目
1. **認証機能**
   - 現在のユーザーのメールアドレスが正しく取得できる
   - Master_Employeeシートとの照合が動作する

2. **打刻機能**
   - WebAppが正常に表示される
   - 打刻データがLog_Rawシートに記録される
   - 重複チェックが動作する
   - 整合性チェック（出勤前の退勤など）が動作する

3. **業務ロジック**
   - 労働時間の計算が正確に行われる
   - 休憩時間の自動控除が動作する
   - 残業時間の計算が正確に行われる
   - 祝日判定が正常に動作する

4. **データアクセス**
   - 各シートからのデータ読み取りが正常に動作する
   - データの書き込みが正常に動作する
   - シート保護設定が適用されている

### エラーが発生する可能性がある箇所
1. **権限エラー**
   - スプレッドシートへのアクセス権限
   - Gmail送信権限（メール機能使用時）

2. **データエラー**
   - Master_Employeeシートにサンプルデータが不足
   - 日付フォーマットの不一致

3. **関数参照エラー**
   - 未実装の関数の呼び出し
   - 関数名の不一致

## トラブルシューティング

### よくある問題と解決方法

#### 1. 「関数が見つかりません」エラー
- 全てのソースファイルがGoogle Apps Scriptプロジェクトにコピーされているか確認
- 関数名のスペルミスがないか確認

#### 2. 「シートが見つかりません」エラー
- `runInitialSetup()`を実行してスプレッドシート構造を作成
- シート名が正しく設定されているか確認

#### 3. 「権限がありません」エラー
- Google Apps Scriptの実行権限を確認
- スプレッドシートの共有設定を確認

#### 4. WebAppにアクセスできない
- デプロイ設定を確認
- アクセス権限の設定を確認
- 新しいバージョンでデプロイし直す

## 次のステップ

動作確認が完了したら、以下の未実装機能の開発に進みます：

1. **自動処理トリガーの実装**（タスク9）
2. **エラーハンドリングシステムの実装**（タスク10）
3. **承認処理とステータス更新の実装**（タスク11）
4. **レポート生成・エクスポート機能の実装**（タスク12）

各機能の実装後は、同様の手順で動作確認を行い、段階的にシステムを完成させていきます。